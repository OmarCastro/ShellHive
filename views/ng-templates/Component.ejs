<div component ng-repeat="data in visualData.components track by data.id" ng-switch on='data.type' data-node-id="{{data.id}}" ng-style="{transform:transform, WebkitTransform:transform, MsTransform:transform}" class="{{data.type}}-component component">
  
  <div ng-switch-when="input">
    <div class="title"> INPUTS </div>
    <div class="ports">
      <div class="input">
        <span ng-repeat="port in data.ports">
          <span data-port="input" class="box"></span>
          <input type="text" ng-model="data.ports[$index]">
          <br>
        </span>
        <button ng-click="data.ports.push('')" class="btn btn-xs btn-default"><span class="glyphicon glyphicon-plus"></span></button>
      </div>
    </div>
  </div>

  <div ng-switch-when="output">
    <div class="title"> OUTPUTS </div>
    <div class="ports">
      <div class="input">
        <span ng-repeat="port in data.ports">
          <span data-port="input" class="box"></span>
          <input type="text" ng-model="data.ports[$index]">
          <br>
        </span>
        <button ng-click="data.ports.push('')" class="btn btn-xs btn-default"><span class="glyphicon glyphicon-plus"></span></button>
      </div>
    </div>
  </div>


  <div ng-switch-when="file">
    <div title="{{data.filename}}" class="title">
      FILE
      <span class="button-group">
        <a ng-click="togglecollapse()" 
           class="glyphicon" 
           ng-class="(collapsed)?'glyphicon-chevron-up':'glyphicon-chevron-down'">
        </a> 
        <a ng-click="$emit('removeComponent', data.id)" class="close-button glyphicon glyphicon-remove"></a>
    </div>
    <div class="ports">
      <div class="input">
        <div data-port="{{port.name}}" ng-repeat="port in inputPorts">        
          <span class="box"></span>
          <span class="text" ng-bind="port.text"></span>
        </div>
      </div>
      <div style="text-align: right" class="output">

        <div data-port="{{port.name}}" ng-repeat="port in outputPorts">        
          <span class="text" ng-bind="port.text"></span>
          <span class="box"></span>
       </div>

      </div>
      <div style="clear: both;"></div>
    </div>
    <input parameter-field class="filename" type="text" ng-model="data.filename">
  </div>
  
  
  
  

  <div ng-switch-when="macro">
    <div title="{{data.macro.description}}" class="title">
      <span ng-bind="data.macro.name"></span>
           <span class="button-group">
        <a ng-click="togglecollapse()" 
           class="glyphicon" 
           ng-class="(collapsed)?'glyphicon-chevron-up':'glyphicon-chevron-down'">
        </a> 
        <a ng-click="$emit('removeComponent', data.id)" class="close-button glyphicon glyphicon-remove"></a>
    </div>
    <div class="ports">
      <div class="input">
        <div data-port="{{port.name}}" ng-repeat="port in inputPorts">        
          <span class="box"></span>
          <span class="text" ng-bind="port.text"></span>
        </div>
      </div>
      <div style="text-align: right" class="output">

        <div data-port="{{port.name}}" ng-repeat="port in outputPorts">        
          <span class="text" ng-bind="port.text"></span>
          <span class="box"></span>
       </div>

      </div>
      <div style="clear: both;"></div>
    </div>
    <div>{{data.macro.description}}</div>
    <div class="btn btn-sm btn-primary" ng-click="graph.setGraphView(data.graph)">view macro</div>
  </div>
  
  
  
  
  
  <div ng-switch-when="command">
    <div class="title">
      <span ng-bind="data.exec"></span>
      <span class="button-group">
        <a ng-click="togglecollapse()" 
           class="glyphicon" 
           ng-class="(collapsed)?'glyphicon-chevron-up':'glyphicon-chevron-down'">
        </a> 
        <a ng-click="$emit('removeComponent', data.id)" class="close-button glyphicon glyphicon-remove"></a>
      </span> 
    </div>
    <div class="ports">
      <div class="input">
        <div data-port="{{port.name}}" ng-repeat="port in inputPorts">        
          <span class="box"></span>
          <span class="text" ng-bind="port.text"></span>
        </div>
      </div>
      <div style="text-align: right" class="output">

        <div data-port="{{port.name}}" ng-repeat="port in outputPorts">        
          <span class="text" ng-bind="port.text"></span>
          <span class="box"></span>
       </div>

      </div>
      <div style="clear: both;"></div>
    </div>
    
    
    
    <div ng-if="data.files !== undefined && (!collapsed || data.files.length)">files :<br ng-if="data.files.length > 0">
      <div ng-repeat="file in data.files track by $index">
        <span data-port="file{{$index}}">
          <span class="box"></span>
        </span>
        <input type="text" ng-model="data.files[$index]" ng-if="isString(data.files[$index])">
        <span ng-bind-template="{{' '+data.files[$index][0]+' '}}" ng-if="isArray(data.files[$index])"></span>
        <button  ng-if="!collapsed" ng-click="data.files.splice($index,1)" class="btn btn-xs btn-default">
          <span class="glyphicon glyphicon-remove"></span>
        </button>
        <button  ng-click="swapPrevious(data.files,$index,data.id)" ng-if="$index && !collapsed" class="btn btn-xs btn-default">
          <span class="glyphicon glyphicon-chevron-up"></span>
        </button>
        <button ng-click="swapPrevious(data.files,$index + 1,data.id)" ng-if="$index != data.files.length -1 && !collapsed" class="btn btn-xs btn-default">
        <span class="glyphicon glyphicon-chevron-down"></span>
        </button><br>
      </div>
      <button ng-if="!collapsed" ng-click="data.files.push('')" class="btn btn-xs btn-default"><span class="glyphicon glyphicon-plus"></span></button><br>
    </div>
    <div ng-if="data.exec == 'awk'">script:<br>
      <textarea parameter-field type="text" ng-model="data.script"></textarea>
    </div>
    
    
    <div ng-if="data.parameters">
      <div ng-repeat="(name, option) in data.parameters track by name">
        <div class="input-group input-group-sm"><span ng-bind="name" class="input-group-addon"></span>
          <input parameter-field type="text" ng-model="data.parameters[name]" class="form-control">
        </div>
      </div>
    </div>
    
    
    <div ng-if="data.exec == 'grep'">
      <div>
        <label>pattern:
          <input parameter-field type="text" ng-model="data.pattern">
        </label><br>
      </div>
    </div>
    <div ng-if="isImplemented(data) &amp;&amp; data.selectors">
      <form name="myForm" ng-repeat="(name, option) in data.selectors track by name">
        <div ng-class="{'has-error': myForm.field.$invalid}" class="input-group input-group-sm">
          <label ng-bind="name" class="input-group-addon"></label>
          <input type="number" name="field" ng-model="data.selectors[name].value" 
                 ng-if="data.selectors[name].type == 'numeric parameter'" min="0" required class="form-control">
          <div class="input-group-btn">
            <button elscope type="button" ng-click="graph.setSelection({data:data, name:name},scopedElement)" class="btn btn-default">
              <span ng-bind="data.selectors[name].name"></span><span class="caret"></span>
            </button>
          </div>
          <input type="text" ng-model="data.selectors[name].value" name="field" 
                 ng-if="data.selectors[name].type == 'parameter'" class="form-control">
        </div>
      </form>
    </div>
    <div>
      <span ng-repeat="(name, val) in data.flags track by name" ng-click="data.flags[name] = !val;$emit('updateComponent',data)" ng-if="!collapsed || data.flags[name]">
        <label ng-class="(val)?'glyphicon-check':'glyphicon-unchecked'" class="glyphicon"></label>
        <label ng-bind="name"></label>
        <br>
      </span>
    </div>
  </div>
</div>