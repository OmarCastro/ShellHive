'use strict';(function(){var k,t,m,f;document.querySelector("div.graph");document.querySelector("div.nodes");document.querySelector("svg.edges");k=null;t=function(c){var b,a,e,d;b=document.documentElement;a=0;for(e=c.length;a<e;++a)if(d=c[a],d in b.style)return d}(["transform","WebkitTransform","MozTransform"]);m=io.connect();m.on("nodePosChanged",function(c){requestAnimationFrame(function(){return k.nodes[c.id].api.moveTo(c.x,c.y)})});f=angular.module("drag",[]);f.controller("Controller",function(c){c.dataNodes=
[];c.dataEdges=[];m.on("flowData",function(b){var a,e,d;k=b;for(a in e=b.nodes)d=e[a],"maxid"!==a&&(d.edges=[],c.dataNodes.push(d));for(a in e=b.edges)d=e[a],"maxid"!==a&&c.dataEdges.push(d);c.$apply()});m.emit("graph-user","")});f.directive("component",function(c){return{scope:!0,link:function(b,a,e){var d,p,h,g,l,n,k,q,r,f,s,u,v,w,x;d=b.$parent.node;h=p=0;g=d.x;l=d.y;n=a[0];k=n.style;a.bind("pointerdown",function(a){var b;b=a.target.tagName;"INPUT"!==b&&"SELECT"!==b&&"LABEL"!==b&&(c.bind("pointermove",
q),c.bind("pointerup",s),p=a.screenX-g,h=a.screenY-l,a.preventDefault(),a.stopPropagation())});q=function(a){r(a.screenX-p,a.screenY-h);m.emit("nodePosChanged",{id:d.id,x:g,y:l})};r=function(a,b){g=a;l=b;f()};f=function(){var a,b,c,e;k[t]="translate("+g+"px, "+l+"px)";a=0;for(c=(b=d.edges).length;a<c;++a)e=b[a],e.api.updateEdge()};s=function(){c.unbind("pointermove",q);c.unbind("pointerup",s);return c};b=n.firstChild.getBoundingClientRect();a=n.querySelector("div.input .box").getBoundingClientRect();
e=n.querySelector("div.output .box").getBoundingClientRect();u=a.left+a.width/2-b.left;v=a.top+a.height/2-b.top;w=e.left+e.width/2-b.left;x=e.top+e.height/2-b.top;d.api={inputPos:function(){return{x:g+u,y:l+v}},outputPos:function(){return{x:g+w,y:l+x}},pos:function(){return{x:g,y:l}},size:{width:b.width,height:b.height},getbbox:function(){return n.firstChild.getBoundingClientRect()},moveTo:r};f()},restrict:"C"}});f.directive("connector",function(c){return{scope:!0,link:function(b,a,c){var d,f,h,g;
b=b.$parent.edge;d=k.nodes[b.start];f=k.nodes[b.end];d.edges.push(b);f.edges.push(b);h=a[0];g=function(a,b,c,d){var e;e=(c-a)/4;return h.setAttribute("d","M "+a+" "+b+" C "+(a+e)+","+b+" "+(a+3*e)+","+d+" "+c+","+d)};a=function(){var a,b;a=d.api.outputPos();b=f.api.inputPos();return g(a.x,a.y,b.x,b.y)};b.api={updateEdge:a};h.addEventListener("pointerdown",function(){h.classList.toggle("sel");h.classList.contains("sel")&&m.emit("run-app",{id:1})});a()}}})}).call(this);
